import{a as useRouter,u as useMessage,r as ref,l as watch,p as onMounted,c as createElementBlock,d as createVNode,w as withCtx,b as createBaseVNode,g as unref,s as createBlock,v as createCommentVNode,j as resolveComponent,o as openBlock,h as isRef,F as Fragment,q as renderList,e as createTextVNode,t as toDisplayString}from"./index-BC6Xn69q.js";const _hoisted_1={class:"container"},_hoisted_2=createBaseVNode("div",{class:"font-bold text-[18px]"}," Davomat ",-1),_hoisted_3=createBaseVNode("th",{class:"w-[40px]"},"â„–",-1),_hoisted_4=createBaseVNode("th",null,"F.I",-1),_hoisted_5={class:"w-[150px]"},_hoisted_6=createBaseVNode("th",null,"Mavjud",-1),_hoisted_7=createBaseVNode("th",null,"Sana ",-1),_hoisted_8=createBaseVNode("th",null,"Sabab",-1),_hoisted_9=createBaseVNode("th",null,"Tasnif",-1),_hoisted_10={class:"text-center"},_hoisted_11={key:1},_hoisted_12=createBaseVNode("td",{colspan:"7"},[createBaseVNode("div",{class:"flex h-[70px] flex-col select-none items-center h-4 selected"},[createBaseVNode("span",{class:""},[createBaseVNode("span",{class:"text-[30px] text-red-500 font-bold material-symbols-outlined"}," close ")]),createBaseVNode("span",null," Ma'lumot mavjud emas ")])],-1),_hoisted_13=[_hoisted_12],_hoisted_14={class:"flex justify-end mt-3 w-full p-4"},_hoisted_15=createBaseVNode("span",{class:"material-symbols-outlined"}," save ",-1),_sfc_main={__name:"issues",setup(__props){const router=useRouter(),message=useMessage();let roleId=ref(null),workers=ref([]);ref(Date.now()),watch(roleId,async(e,a)=>{const o=localStorage.token;let r=await fetch(`${window.base}/admin/get_worker_search/all/?${new URLSearchParams({role_id:e}).toString()}`,{method:"GET",headers:{"Content-type":"application/json","-x-token":o}});r.status==200&&(r=await r.json(),workers.value=[],r.length&&r.forEach(n=>{workers.value.push({active:!1,worker_id:n.id,reason:!1,detail:"Sababsiz",time:Date.now(),lastname:n.lastname,firstname:n.firstname,role_name:n.role_name})}))});const roleList=ref([]),getRole=async function(){try{const e=localStorage.token;let a=await fetch(`${window.base}/admin/get_role`,{method:"GET",headers:{"Content-type":"application/json","-x-token":e}});if(a.status==401)return router.push("/admin/login");a.status==200&&(roleList.value=[{label:"Roleni tanglang",value:"-1",disabled:!0}],a=await a.json(),a.forEach(o=>roleList.value.push({label:o.name,value:o.id})))}catch(e){console.log(e)}};onMounted(async()=>{await getRole()});let save=async function(){let validate=!0;if(workers.value.forEach(e=>{new Date(e.time).getTime()>new Date().getTime()&&(message.warning(`${e.lastname} ${e.firstname}ning davomatida vaqt oshib ketdi`),validate=!1)}),!validate||(workers.value.forEach(e=>{e.detail.length<5&&(message.warning(`${e.lastname} ${e.firstname}ning davomatida sababligi 5 ta belgidan kam bo'lmasligi lozim`),validate=!1)}),!validate))return;let rebody=[];workers.value.forEach((e,a)=>{e.active&&rebody.push({reason:e.reason,detail:e.detail,worker_id:e.worker_id,time:e.time})}),rebody.forEach((e,a)=>{const o=new Date(e.time),r=o.getFullYear(),n=o.getMonth()+1,l=o.getDate();rebody[a].time=`${l.toString().padStart(2,"0")}-${n.toString().padStart(2,"0")}-${r}`});let token=localStorage.token;try{let backend=await fetch(`${window.base}/admin/add_issues`,{method:"POST",headers:{"Content-type":"application/json","-x-token":token},body:JSON.stringify(rebody)});if(backend.status==201&&(workers.value=[],roleId.value=null,message.success("Ma'lumotlar qo'shildi")),backend.status==401)return router.push("/admin/login");if(backend.status==203){backend=await backend.json();let arr=backend.error;arr=arr.split("Key"),arr=arr.toString(),arr=arr.split(","),arr=arr.toString(),arr=arr.split("worker_id"),arr=arr.toString(),arr=arr.split('"("'),arr=arr.toString(),arr=arr.split(")"),arr=arr.toString(),arr=arr.split(" already exists."),arr=arr.toString(),arr=arr.split('"time"'),arr=arr.toString(),arr=arr.split("="),arr=arr.toString(),arr=arr.split("("),arr=arr.toString(),arr=arr.toString(),arr=arr.split(" "),arr=arr.toString(),arr=arr.split(","),arr=arr.filter(e=>e.length>0);const token=localStorage.token;let backend1=await fetch(`${window.base}/admin/get_worker_search/byid/${eval(arr[0])}`,{method:"GET",headers:{"Content-type":"application/json","-x-token":token}});if(backend1.status==200)return backend1=await backend1.json(),message.error(`${backend1.lastname} ${backend1.firstname} ${arr[1]} sanada davomatdan o'tgan`)}}catch(e){console.log(e)}};return(e,a)=>{const o=resolveComponent("n-select"),r=resolveComponent("n-switch"),n=resolveComponent("n-date-picker"),l=resolveComponent("n-input"),d=resolveComponent("n-table"),i=resolveComponent("n-button");return openBlock(),createElementBlock("div",_hoisted_1,[_hoisted_2,createVNode(d,{bordered:!1,"single-line":!1},{default:withCtx(()=>[createBaseVNode("thead",null,[createBaseVNode("tr",null,[_hoisted_3,_hoisted_4,createBaseVNode("th",_hoisted_5,[createVNode(o,{placeholder:"Rollarni tanlang",value:unref(roleId),"onUpdate:value":a[0]||(a[0]=t=>isRef(roleId)?roleId.value=t:roleId=t),size:"medium",options:roleList.value},null,8,["value","options"])]),_hoisted_6,_hoisted_7,_hoisted_8,_hoisted_9])]),createBaseVNode("tbody",null,[unref(workers).length>0?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(unref(workers),(t,c)=>(openBlock(),createElementBlock("tr",{key:t.id},[createBaseVNode("td",null,toDisplayString(++c),1),createBaseVNode("td",null,toDisplayString(t.lastname)+" "+toDisplayString(t.firstname),1),createBaseVNode("td",_hoisted_10,toDisplayString(t.role_name),1),createBaseVNode("td",null,[createVNode(r,{value:t.active,"onUpdate:value":s=>t.active=s},{checked:withCtx(()=>[createTextVNode(" Kelmagan ")]),unchecked:withCtx(()=>[createTextVNode(" Kelgan ")]),_:2},1032,["value","onUpdate:value"])]),createBaseVNode("td",null,[createVNode(n,{disabled:!t.active,value:t.time,"onUpdate:value":s=>t.time=s,"max-value":t.time,type:"date"},null,8,["disabled","value","onUpdate:value","max-value"])]),createBaseVNode("td",null,[createVNode(r,{disabled:!t.active,value:t.reason,"onUpdate:value":s=>t.reason=s},{checked:withCtx(()=>[createTextVNode(" Sababli ")]),unchecked:withCtx(()=>[createTextVNode(" Sababsiz ")]),_:2},1032,["disabled","value","onUpdate:value"])]),createBaseVNode("td",null,[t.reason?(openBlock(),createBlock(l,{key:0,value:t.detail,"onUpdate:value":s=>t.detail=s,type:"textarea",placeholder:"Basic Textarea"},null,8,["value","onUpdate:value"])):createCommentVNode("",!0)])]))),128)):createCommentVNode("",!0),unref(workers).length==0?(openBlock(),createElementBlock("tr",_hoisted_11,_hoisted_13)):createCommentVNode("",!0)])]),_:1}),createBaseVNode("div",_hoisted_14,[unref(workers).length>0?(openBlock(),createBlock(i,{key:0,onClick:unref(save)},{default:withCtx(()=>[_hoisted_15,createTextVNode(" Saqlash ")]),_:1},8,["onClick"])):createCommentVNode("",!0)])])}}};export{_sfc_main as default};
